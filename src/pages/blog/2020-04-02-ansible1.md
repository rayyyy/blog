---
slug: ansible1
published_date: 2018-11-27T15:00:00.000Z
updated_date: 2018-11-27T15:00:00.000Z
title: ansibleで作業の自動化をする【入門】その１
tags:
  - ansible
---
## ansible

https://www.ansible.com/

**ansible**とは**Red Hat**のオープンソースの**構成管理ツール**です。

最近、**Software Design**を読んで、いろいろな作業の自動化に使えることを知り、

入門してみました。

### 特徴

* エージェントレス

  * 自動化の対象にエージェントソフトのインストールをする必要がない。
* 様々な機器をコントロール可能

  * クラウドや、ネットワーク機器、物理サーバーなどなど
* 指示書がシンプルに作れる(Playbook)

  * コードを自動化の指示書として扱える
* 冪等性を担保できる

  * 自動化処理を何回でも実行できる

### サンプルコード

一旦サンプルコードです。

localhost.yml

```
- hosts: localhost
  connection: local # sshせずにlocalhostで実行
  gather_facts: no # ターゲットホストの情報取得
  sudo: no
  tasks:
    - name: hoge.txtを作る
      command: touch hoge.txt chdir=/Users/taro/ansible creates=/Users/taro/ansible/hoge.txt # createsはすでに存在したら実行しないオプション
```

**/Users/taro/ansible**配下に**hoge.txt**を作るコードです。

自動化の対象を用意しておく必要があるので、

hostsというファイルを用意します。

hosts

```
localhost
```

ファイルツリーはこちらです

ファイルツリー
```
.
├── hosts
└── localhost.yml
```

↓のコードで実行できます。

shell
```
ansible-playbook localhost.yml -i hosts
```

結果は。。。

結果
```
$ ll
total 16
drwxr-xr-x   5 taro  staff  160 11 27 20:33 .
drwxr-xr-x  22 taro  staff  704 11 27 19:23 ..
-rw-r--r--   1 taro  staff    0 11 27 20:33 hoge.txt # 増えてる
-rw-r--r--   1 taro  staff   10 11 27 19:26 hosts
-rw-r--r--   1 taro  staff  296 11 27 20:26 localhost.yml
```

増えてますね！！

といったようにシンプルに作れます！

では、実際に作ってみます。

### 作るもの

#### 前提

**複数サーバー**に**またがった**一つの**サービス**があります。

それぞれのサーバーに、**Gitプロジェクト**があり、**masterブランチ**を**pull**することで、**デプロイ**出来ます。

手動で一つずつデプロイしてたものをansibleで簡略化します。

#### デプロイ手順【今まで】

1. サーバーAにSSHして、該当箇所まで移動して”git pull origin master”
2. サーバーBにSSHして、該当箇所まで移動して”git pull origin master”
3. サーバーCにSSHして、該当箇所まで移動して”git pull origin master”

デプロイ完了

#### デプロイ手順【ansible】

1. ローカルからansible実行

デプロイ完了



次回実際に作ったものをアップします！